boolrunOnMachineFunction(MachineFunction&MF) override {
   Subtarget = &MF.getSubtarget<PPCSubtarget>();
   bool retval = AsmPrinter::runOnMachineFunction(MF);
   UI.recordUnwindInfo(MF);

   if(MF.getFrameInfo()->hasStackMap()) {
     //Add the LR & FP save slots
     const TargetFrameLowering *TFL = Subtarget->getFrameLowering();
     const PPCFunctionInfo *FI = MF.getInfo<PPCFunctionInfo>();
     int Index, Offset;
     unsigned BaseReg;

     LROffset = MF.getFrameInfo()->getStackSize() + 16;
     UI.addRegisterUnwindInfo(MF, PPC::LR8, LROffset);

     FPIndex = FI->getFramePointerSaveIndex();
     FPOffset = TFL->getFrameIndexReferenceFromFP(MF, FPIndex, BaseReg);
     UI.addRegisterUnwindInfo(MF, PPC::X31, FPOffset);
   }

   return retval;
 }
};

